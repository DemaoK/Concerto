<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Introduction to Merger Trees" href="intro_to_merger_trees.html" /><link rel="prev" title="Data Access" href="data_access.html" />

    <meta name="generator" content="sphinx-4.2.0, furo 2022.06.21"/>
        <title>Data Analysis Tutorial - Symphony 1.1.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=40978830699223671f4072448e654b5958f38b89" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Symphony 1.1.2 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Symphony 1.1.2 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="simulations.html">Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits_acknowledgements.html">People &amp; Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart &amp; FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_access.html">Data Access</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Data Analysis Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_to_merger_trees.html">Introduction to Merger Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="symlib_documentation.html">Library Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_reading.html">Background Reading</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="data-analysis-tutorial">
<h1>Data Analysis Tutorial<a class="headerlink" href="#data-analysis-tutorial" title="Permalink to this headline">#</a></h1>
<p>Symphony data is stored in cutsom data formats and must be read with its analysis library, <code class="docutils literal notranslate"><span class="pre">symlib</span></code>. This page contains tutorials and example code showing how to use this library. A complete, detailed reference for this library can be found <a class="reference internal" href="symlib_documentation.html"><span class="doc">here</span></a>.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">#</a></h2>
<p>As disucssed in the <a class="reference internal" href="data_access.html"><span class="doc">Data Access</span></a> page, <code class="docutils literal notranslate"><span class="pre">symlib</span></code>  can be downloaded with the pip tool.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install symlib -U
</pre></div>
</div>
</section>
<section id="reading-in-subhalo-data">
<h2>Reading in Subhalo Data<a class="headerlink" href="#reading-in-subhalo-data" title="Permalink to this headline">#</a></h2>
<p>The first step to working with simulation data is loading the simulation
parameters. This is a dictionary containing cosmological and numerical
information. These can be looked up with <a class="reference internal" href="symlib_documentation.html#symlib.simulation_parameters" title="symlib.simulation_parameters"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.simulation_parameters()</span></code></a> by giving the directory of the halo as an argument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">symlib</span>

<span class="c1"># sim_dir is the location of a single halo. We&#39;ll talk about</span>
<span class="c1"># auto-generating this later, but if you downloaded &quot;Halo933&quot;</span>
<span class="c1"># in the suite &quot;SymphonyLMC&quot; to the directory &quot;data/&quot;, this</span>
<span class="c1"># would be &quot;data/SymphonyLMC/Halo933&quot;</span>
<span class="n">sim_dir</span> <span class="o">=</span> <span class="s2">&quot;path/to/ExampleHalo&quot;</span>

<span class="n">params</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">simulation_parameters</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;flat&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;H0&#39;</span><span class="p">:</span> <span class="mf">70.0</span><span class="p">,</span> <span class="s1">&#39;Om0&#39;</span><span class="p">:</span> <span class="mf">0.286</span><span class="p">,</span> <span class="s1">&#39;Ob0&#39;</span><span class="p">:</span> <span class="mf">0.049</span><span class="p">,</span>
 <span class="s1">&#39;sigma8&#39;</span><span class="p">:</span> <span class="mf">0.82</span><span class="p">,</span> <span class="s1">&#39;ns&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="mf">0.17</span><span class="p">,</span> <span class="s1">&#39;mp&#39;</span><span class="p">:</span> <span class="mf">281981.0</span><span class="p">,</span>
 <span class="s1">&#39;h100&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">}</span>
</pre></div>
</div>
<p>The first six values are <a class="reference external" href="https://bdiemer.bitbucket.io/colossus/">colossus</a>-compatible cosmological parameters, the next two are numerical parameters (<code class="docutils literal notranslate"><span class="pre">&quot;eps&quot;</span></code> is the radius of each particle in comoving <span class="math notranslate nohighlight">\(h^{-1}{\rm kpc}\)</span>, and <code class="docutils literal notranslate"><span class="pre">mp</span></code> is the mass of each particle in <span class="math notranslate nohighlight">\(h^{-1}M_\odot\)</span>). The last value is <span class="math notranslate nohighlight">\(h_{100} = H_0/(100\ {\rm km/s})\)</span>, which is often convenient to have.</p>
<p>Next, we read in the subhalos with the function <a class="reference internal" href="symlib_documentation.html#symlib.read_subhalos" title="symlib.read_subhalos"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.read_subhalos()</span></code></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">halos</span><span class="p">,</span> <span class="n">histories</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">read_subhalos</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>
</pre></div>
</div>
<p>There are two return return values, <code class="docutils literal notranslate"><span class="pre">halos</span></code> and <code class="docutils literal notranslate"><span class="pre">histories</span></code>. In your
code, you’ll probably want to abbreviate these as <code class="docutils literal notranslate"><span class="pre">h</span></code> and <code class="docutils literal notranslate"><span class="pre">hist</span></code>, or something similar, following the library code.</p>
<p><code class="docutils literal notranslate"><span class="pre">halos</span></code> is a 2D array that represents how the host halo and all its subhalos evolve over time. The first index accesses different halos and
second different times. It contains information like mass and
position. <code class="docutils literal notranslate"><span class="pre">halos[0,235]</span></code> is the host halo at snapshot
235, the last snapshot in the simulation. <code class="docutils literal notranslate"><span class="pre">halos[3,</span> <span class="pre">100]</span></code> is the third
largest subhalo, including disrupted subhalos, at snapshot 100. Subhalos are ordered according to the largest mass they ever had, <span class="math notranslate nohighlight">\(M_{\rm peak}\)</span>. Halos stay at the same index across their lifetimes.</p>
<p><code class="docutils literal notranslate"><span class="pre">histories</span></code> contains summary information about a halo’s full history, including <span class="math notranslate nohighlight">\(M_{\rm peak}\)</span> and when that subhalo fell into the host. Its length and ordering are the same as the first index of <code class="docutils literal notranslate"><span class="pre">halos</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">halos</span></code> is a numpy structured array has type <a class="reference internal" href="symlib_documentation.html#symlib.SUBHALO_DTYPE" title="symlib.SUBHALO_DTYPE"><code class="xref py py-data docutils literal notranslate"><span class="pre">symlib.SUBHALO_DTYPE</span></code></a>, and <code class="docutils literal notranslate"><span class="pre">histories</span></code> is a structured array with type <a class="reference internal" href="symlib_documentation.html#symlib.HISTORY_DTYPE" title="symlib.HISTORY_DTYPE"><code class="xref py py-data docutils literal notranslate"><span class="pre">symlib.HISTORY_DTYPE</span></code></a>. Structured arrays are arrays that have different fields which can be accessed with strings. For example, <code class="docutils literal notranslate"><span class="pre">halos[3,100][&quot;mvir&quot;]</span></code> and <code class="docutils literal notranslate"><span class="pre">halos[&quot;mvir&quot;][3,100]</span></code> both return the mass, <span class="math notranslate nohighlight">\(M_{\rm vir}\)</span> of the third most massive halo at snapshot 100. The non-string indices obey normal numpy indexing rules, so you can use slicing, boolean indexing, axis removal and whatever other tricks you use with normal numpy arrays.</p>
<p>The full set of fields in <code class="docutils literal notranslate"><span class="pre">halos</span></code> is described in the <a class="reference internal" href="symlib_documentation.html#symlib.SUBHALO_DTYPE" title="symlib.SUBHALO_DTYPE"><code class="xref py py-data docutils literal notranslate"><span class="pre">symlib.SUBHALO_DTYPE</span></code></a> documentation. In this tutorial we will only use:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;x&quot;</span></code> - three-dimensional position vector (x, y, z)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;v&quot;</span></code> - three-dimensional velocity vector (v_x, v_y, v_z)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;mvir&quot;</span></code> - Mass</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;rvir&quot;</span></code> - Radius</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;ok&quot;</span></code> - <code class="docutils literal notranslate"><span class="pre">True</span></code> if the halo was tracked by the halo finder the given snapshot, <code class="docutils literal notranslate"><span class="pre">False</span></code> if the halo was not tracked by the halo finder at the given snapshot.</p>
<blockquote>
<div><p>TLDR:
Throughout the lifetime of a halo, there are two periods of time when the size of the halo is too small (below the resolution limit of the simulation) for the halo finder to track its position:</p>
<ol class="arabic simple">
<li><p>near the beginning of a halo’s formation when it starts to rapidly accrete mass, or</p></li>
<li><p>towards the end of a halo’s life when it is shredded apart by the host halo and rapidly loses mass.</p></li>
</ol>
<p>During these periods of time, <code class="docutils literal notranslate"><span class="pre">halos[&quot;ok&quot;]</span></code> will be <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</div></blockquote>
</li>
</ul>
<p>Fields in <code class="docutils literal notranslate"><span class="pre">histories</span></code> will be explained as needed, but can be found in full in the <a class="reference internal" href="symlib_documentation.html#symlib.HISTORY_DTYPE" title="symlib.HISTORY_DTYPE"><code class="xref py py-data docutils literal notranslate"><span class="pre">symlib.HISTORY_DTYPE</span></code></a> documentation.</p>
</section>
<section id="example-subhalo-analysis-plotting-postions">
<h2>Example Subhalo Analysis: Plotting Postions<a class="headerlink" href="#example-subhalo-analysis-plotting-postions" title="Permalink to this headline">#</a></h2>
<p>Our first step with analyzing any simulation data should be to look at it
qualitatively. We’ll start by looking at the positions of the major subhalos
around our central halo at the last snapshot of the simulation. We will plot the central halo in one color and the subhalos in another. We’ll also need to skip all the subhalos that were destroyed before the end of the simulation.</p>
<p>We’ll also use a utility function, <a class="reference internal" href="symlib_documentation.html#symlib.plot_circle" title="symlib.plot_circle"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.plot_circle()</span></code></a> to make the
circles.</p>
<div class="highlight-python notranslate" id="halo-position-example"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">symlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">sim_dir</span> <span class="o">=</span> <span class="s2">&quot;path/to/ExampleHalo&quot;</span>
<span class="n">h</span><span class="p">,</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">read_subhalos</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># First halo, last snapshot.</span>
<span class="n">symlib</span><span class="o">.</span><span class="n">plot_circle</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">host</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">host</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                   <span class="n">host</span><span class="p">[</span><span class="s2">&quot;rvir&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;tab:red&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)):</span>
    <span class="n">sub</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># i-th halo, last snapshot.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;ok&quot;</span><span class="p">]:</span> <span class="k">continue</span>
    <span class="n">symlib</span><span class="o">.</span><span class="n">plot_circle</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">,</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;rvir&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;tab:blue&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>With a little bit of additional pyplot work that we’ve ellided here, this gives us the following. The full script used to create this image, including the omitted pyplot code is shown in <a class="reference external" href="https://github.com/phil-mansfield/symphony/blob/main/examples/positions.py">examples/positions.py</a>.</p>
<a class="reference internal image-reference" href="_images/positions.png"><img alt="_images/positions.png" src="_images/positions.png" style="width: 500px;" /></a>
<p>From this, we can see that our host halo is surrounded by a swarm of subhalos. Bigger subhalos are rarer and generally closer to the center of the host. Some subhalos are outside the radius of the host. These “splashback subhalos” had been inside the host in the past but have temporarily orbited outside of it. They are included in the symlink catalogs by default.</p>
<p>Let’s review the concepts that went into creating this image:</p>
<ul class="simple">
<li><p>We read in simulation parameters and halo information with <a class="reference internal" href="symlib_documentation.html#symlib.simulation_parameters" title="symlib.simulation_parameters"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.simulation_parameters()</span></code></a> and <a class="reference internal" href="symlib_documentation.html#symlib.read_subhalos" title="symlib.read_subhalos"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.read_subhalos()</span></code></a>.</p></li>
<li><p>We got the host halo at the last snapshot with <code class="docutils literal notranslate"><span class="pre">halos[0,-1]</span></code> and the subhalos with <code class="docutils literal notranslate"><span class="pre">halos[i,-1]</span></code>.</p></li>
<li><p>We got a vector representing the postion of the host by accessing <code class="docutils literal notranslate"><span class="pre">host[&quot;x&quot;]</span></code> and the radius with <code class="docutils literal notranslate"><span class="pre">host[&quot;rvir&quot;]</span></code> and were able to get similar quantities for subhalos.</p></li>
<li><p>We needed to check <code class="docutils literal notranslate"><span class="pre">sub[&quot;ok&quot;]</span></code> to make sure that the halo still existed at the snapshot we were interested in.</p></li>
</ul>
<p>Here, the central halo at index 0 is red and all is subhalos are blue.
We used a built-in utility function called <code class="docutils literal notranslate"><span class="pre">plot_circle</span></code> and
needed to skip over some subhalos which disrupted before the final snapshot.</p>
<p><strong>Example exercise</strong></p>
<p>In the <code class="docutils literal notranslate"><span class="pre">histories</span></code> array, there is a field called <code class="docutils literal notranslate"><span class="pre">merger_snap</span></code> that gives the snapshot when a subhalo first fell into the host. Try coloring subhalos that fell in from the left side of the halo (<span class="math notranslate nohighlight">\(x_{\rm infall} &lt; 0\)</span>) differently from ones that fell in from the right.</p>
</section>
<section id="example-analysis-mass-growth">
<h2>Example Analysis: Mass Growth<a class="headerlink" href="#example-analysis-mass-growth" title="Permalink to this headline">#</a></h2>
<p>Now, we’ll try analysis that’s a bit more quantitative. We’ll look at the growth of subhalos over time. To do this, we’ll need to get the scale factors, <span class="math notranslate nohighlight">\(a(z)\)</span>, for each snapshot with <a class="reference internal" href="symlib_documentation.html#symlib.scale_factors" title="symlib.scale_factors"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.scale_factors()</span></code></a>. We’ll also use one of the fields in <code class="docutils literal notranslate"><span class="pre">histories</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;merger_snap&quot;</span></code> which is the snapshot when the subhalo first fell into the host. We’ll use it to plot times before infall as dashed lines and times afterwards as solid lines.</p>
<div class="highlight-python notranslate" id="mah-example"><div class="highlight"><pre><span></span><span class="n">sim_dir</span> <span class="o">=</span> <span class="s2">&quot;path/to/ExampleHalo&quot;</span>

<span class="n">scale</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">scale_factors</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>
<span class="n">h</span><span class="p">,</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">read_subhalos</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>

<span class="n">snaps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="c1"># Snapshots #s, for making cuts.</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:red&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:orange&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:green&quot;</span><span class="p">,</span>
          <span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span> <span class="s2">&quot;tab:purple&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,:][</span><span class="s2">&quot;ok&quot;</span><span class="p">]</span> <span class="c1"># Snapshots where the halo exists</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Plot the host halo</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scale</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ok</span><span class="p">][</span><span class="s2">&quot;mvir&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Plot the full history of the subhalo as a dahsed line</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scale</span><span class="p">[</span><span class="n">ok</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">ok</span><span class="p">][</span><span class="s2">&quot;mvir&quot;</span><span class="p">],</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># Plot its history inside the host halo as a solid line</span>
        <span class="n">is_sub</span> <span class="o">=</span> <span class="p">(</span><span class="n">snaps</span> <span class="o">&gt;=</span> <span class="n">hist</span><span class="p">[</span><span class="s2">&quot;merger_snap&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">ok</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">scale</span><span class="p">[</span><span class="n">is_sub</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">is_sub</span><span class="p">][</span><span class="s2">&quot;mvir&quot;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p>With a little bit of additional pyplot work, this gives us the following. The full script used to create this image, including the omitted pyplot code is shown in <a class="reference external" href="https://github.com/phil-mansfield/symphony/blob/main/examples/mah.py">examples/mah.py</a>.</p>
<a class="reference internal image-reference" href="_images/mah.png"><img alt="_images/mah.png" src="_images/mah.png" style="width: 500px;" /></a>
<p>Here we see that our subhalos spend most of their time in the simulation building up mass prior to falling in. The earlier-infalling halos shown here don’t last for very long: they disrupt in a few snapshots! Others, like the green subhalo survive much longer.</p>
<p>Let’s review the concepts that went into creating this image:</p>
<ul class="simple">
<li><p>We needed to read in scale factors with <a class="reference internal" href="symlib_documentation.html#symlib.scale_factors" title="symlib.scale_factors"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.scale_factors()</span></code></a> to figure out when each snapshot occured.</p></li>
<li><p>We were able to figure out the snapshot when a subhalo fell into the host with <code class="docutils literal notranslate"><span class="pre">histories</span></code>’s <code class="docutils literal notranslate"><span class="pre">&quot;merger_snap&quot;</span></code> field.</p></li>
<li><p>The indices of structured arrays work just like normal numpy arrays, so we were able to select parts of them with the boolean arrays <code class="docutils literal notranslate"><span class="pre">ok</span></code> and <code class="docutils literal notranslate"><span class="pre">is_sub</span></code>.</p></li>
</ul>
<p><strong>Example exercise:</strong></p>
<p>You might have noticed that subhalos start losing mass before they actually start falling into the host (look at the green curve in particular). Using logic similar to the above plot, try figuring out how far away subhalos are on average from a host when they reach their peak mass.</p>
</section>
<section id="example-analysis-the-subhalo-mass-functions">
<h2>Example Analysis: The Subhalo Mass Functions<a class="headerlink" href="#example-analysis-the-subhalo-mass-functions" title="Permalink to this headline">#</a></h2>
<p>Lastly, let’s try some more rigorous statistical analysis. We’re going to measure the subhalo mass function of the entire Milky Way suite. We’ll look at <span class="math notranslate nohighlight">\(N(&gt;M_{\rm peak})\)</span>, the average number of subhalos per host halo whose maximum mass was larger than <span class="math notranslate nohighlight">\(M_{\rm peak}\)</span>. To do this, we’ll need to access the <code class="docutils literal notranslate"><span class="pre">&quot;mpeak&quot;</span></code> field of the <code class="docutils literal notranslate"><span class="pre">histories</span></code> array.</p>
<p>More importantly, to get good statistics we’ll need to loop over all the host halos in the Milky Way suite, <code class="docutils literal notranslate"><span class="pre">SymphonyMilkyWay</span></code>. One way to do this would be to manually store the names of all the halo directories, but instead we’ll use library functions to do it. First, we’ll count the number of halos in the Milky Way-mass suite with <a class="reference internal" href="symlib_documentation.html#symlib.n_hosts" title="symlib.n_hosts"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.n_hosts()</span></code></a>. Then, we can get directory names <a class="reference internal" href="symlib_documentation.html#symlib.get_host_directory" title="symlib.get_host_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.get_host_directory()</span></code></a>, which takes the base directory, suite name, and the index of the halo you want to read. Together this lets you loop over halo directories.</p>
<p>Constructing a mass function has a bit more code overhead than the earlier examples: the important part is how the loop over files works.</p>
<div class="highlight-python notranslate" id="shmf-example"><div class="highlight"><pre><span></span><span class="n">base_dir</span> <span class="o">=</span> <span class="s2">&quot;path/to/base/dir&quot;</span>
<span class="n">suite_name</span> <span class="o">=</span> <span class="s2">&quot;SymphonyMilkyWay&quot;</span>

<span class="c1"># Mass function bins and empty histogram.</span>
<span class="n">log_m_min</span><span class="p">,</span> <span class="n">log_m_max</span><span class="p">,</span> <span class="n">n_bin</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">200</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">log_m_min</span><span class="p">,</span> <span class="n">log_m_max</span><span class="p">,</span> <span class="n">n_bin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">N_vir</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_bin</span><span class="p">)</span>

<span class="n">n_hosts</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">n_hosts</span><span class="p">(</span><span class="n">suite_name</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i_host</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_hosts</span><span class="p">):</span>
    <span class="n">sim_dir</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">get_host_directory</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">suite_name</span><span class="p">,</span> <span class="n">i_host</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">symlib</span><span class="o">.</span><span class="n">read_subhalos</span><span class="p">(</span><span class="n">sim_dir</span><span class="p">)</span>

    <span class="c1"># Only count objects within R_vir</span>
    <span class="n">host_rvir</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;rvir&quot;</span><span class="p">]</span>
    <span class="n">sub_x</span> <span class="o">=</span> <span class="n">h</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sub_x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="s2">&quot;ok&quot;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">host_rvir</span><span class="p">)</span>

    <span class="c1"># Put in bins and add to cumulative histogram</span>
    <span class="n">n_vir</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="s2">&quot;mpeak&quot;</span><span class="p">][</span><span class="n">ok</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">N_vir</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">n_vir</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">n_hosts</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">N_vir</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With a little bit of additional pyplot work, this gives us the following. The full script used to create this image, including the omitted pyplot code is shown in <a class="reference external" href="https://github.com/phil-mansfield/symphony/blob/main/examples/mass_func.py">examples/mass_func.py</a>.</p>
<a class="reference internal image-reference" href="_images/mass_func.png"><img alt="_images/mass_func.png" src="_images/mass_func.png" style="width: 500px;" /></a>
<p>Here, we can see the classic form of the subhalo mass function. At smaller subhalo masses, decreasing the subhalo mass by a increses the number of subhalos by <span class="math notranslate nohighlight">\(N \lesssim M^{-1}\)</span>, and there’s an exponential cutoff as the subhalos get close to the host mass.</p>
<p>Let’s review the concepts that went into creating this image:</p>
<ul class="simple">
<li><p>We needed to use <a class="reference internal" href="symlib_documentation.html#symlib.n_hosts" title="symlib.n_hosts"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.n_hosts()</span></code></a> to find the number of host halos in our target suite</p></li>
<li><p>We needed to use <a class="reference internal" href="symlib_documentation.html#symlib.get_host_directory" title="symlib.get_host_directory"><code class="xref py py-func docutils literal notranslate"><span class="pre">symlib.get_host_directory()</span></code></a> to find the names of the directories in the host halo.</p></li>
<li><p>We needed the <code class="docutils literal notranslate"><span class="pre">&quot;mpeak&quot;</span></code> field of <code class="docutils literal notranslate"><span class="pre">histories</span></code></p></li>
<li><p>We needed to do a little bit of array magic with numpy arrays, although this could also have been done in a less concise way.</p></li>
</ul>
<p><strong>Practice:</strong></p>
<p>Try adding a curve for the mass function of surviving “splashback” subhalos to this plot.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="intro_to_merger_trees.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Introduction to Merger Trees</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="data_access.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Data Access</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Symphony, lead developer Phil Mansfield
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Data Analysis Tutorial</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#reading-in-subhalo-data">Reading in Subhalo Data</a></li>
<li><a class="reference internal" href="#example-subhalo-analysis-plotting-postions">Example Subhalo Analysis: Plotting Postions</a></li>
<li><a class="reference internal" href="#example-analysis-mass-growth">Example Analysis: Mass Growth</a></li>
<li><a class="reference internal" href="#example-analysis-the-subhalo-mass-functions">Example Analysis: The Subhalo Mass Functions</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>